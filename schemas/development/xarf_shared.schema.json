{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/xarf/schema-discussion/master/schemas/development/xarf_shared.schema.json",
  "type": "object",
  "properties": {
    "ReporterInfo": {
      "type": "object",
      "properties": {
        "ReporterOrg": {
          "type": "string",
          "description": "name of the reporter organisation",
          "minLength": 3
        },
        "ReporterOrgDomain": {
          "type": "string",
          "description": "domain.tld of the reporter organisation",
          "format": "hostname"
        },
        "ReporterOrgEmail": {
          "type": "string",
          "description": "email-address of the reporter organisation",
          "format": "email"
        },
        "ReporterOrgAddress": {
          "type": "string",
          "description": "address of the reporter organisation"
        },
        "ReporterContactEmail": {
          "type": "string",
          "description": "email-address of the reporter contact",
          "format": "email"
        },
        "ReporterContactName": {
          "type": "string",
          "description": "name of the reporter contact",
          "minLength": 3
        },
        "ReporterContactPhone": {
          "type": "string",
          "description": "phone number of the reporter contact",
          "minLength": 3
        }
      },
      "required": ["ReporterOrg", "ReporterOrgDomain", "ReporterOrgEmail"]
    },
    "OnBehalfOf": {
      "type": "object",
      "properties": {
        "ComplainantOrg": {
          "type": "string",
          "description": "name of the complainant organisation",
          "minLength": 3
        },
        "ComplainantOrgDomain": {
          "type": "string",
          "description": "domain.tld of the complainant organisation",
          "format": "hostname"
        },
        "ComplainantOrgEmail": {
          "type": "string",
          "description": "email-address of the complainant organisation",
          "format": "email"
        },
        "ComplainantContactEmail": {
          "type": "string",
          "description": "email-address of the complainant contact",
          "format": "email"
        },
        "ComplainantContactName": {
          "type": "string",
          "description": "name of the complainant contact",
          "minLength": 3
        },
        "ComplainantContactPhone": {
          "type": "string",
          "description": "phone number of the complainant contact",
          "minLength": 3
        }
      },
      "required": [
        "ComplainantOrg",
        "ComplainantOrgDomain",
        "ComplainantOrgEmail"
      ]
    },
    "XarfBase": {
      "description": "Base properties for all xarf reports",
      "type": "object",
      "properties": {
        "ReporterInfo": {
          "$ref": "#/properties/ReporterInfo"
        },
        "OnBehalfOf": {
          "$ref": "#/properties/OnBehalfOf"
        },
        "Disclosure": {
          "type": "boolean",
          "description": "if this event is disclosed or not",
          "default": true
        },
        "Version": {
          "const": "development"
        },
        "InternalProcessing": {
          "$ref": "#/properties/InternalProcessing"
        }
      },
      "required": ["ReporterInfo", "Disclosure", "Version"]
    },
    "ReportBase": {
      "description": "Base properties for the report part of all xarf report types",
      "type": "object",
      "properties": {
        "ReportClass": {
          "type": "string",
          "description": "class of the reported abuse event",
          "enum": ["Content", "Activity", "Vulnerability"]
        },
        "ReportType": {
          "type": "string",
          "description": "type of the reported abuse event",
          "minLength": 1
        },
        "ReportSubType": {
          "type": "string",
          "description": "subtype of the reported abuse event"
        },
        "ReporterCaseID": {
          "type": "string",
          "description": "case id of this report given by the reporter"
        },
        "ReporterSeverity": {
          "type": "string",
          "description": "class of the reported abuse event",
          "enum": ["low", "medium", "high"]
        },
        "ReporterNotes": {
          "type": "string",
          "description": "free text - notes by the reporter"
        },
        "Custom": {
          "type": "object",
          "description": "allows for custom key-value fields",
          "additionalProperties": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "integer"
              }
            ]
          }
        }
      },
      "required": ["ReportClass", "ReportType"]
    },
    "IpBasedReport": {
      "allOf": [
        {
          "$ref": "#/properties/ReportBase"
        },
        {
          "$ref": "#/properties/Date"
        },
        {
          "type": "object",
          "properties": {
            "SourceIp": {
              "description": "ip from which the abuse event originated",
              "$ref": "#/properties/Ip"
            },
            "SourcePort": {
              "$ref": "#/properties/Port"
            },
            "ASN": {
              "type": "integer",
              "description": "autonomous system number the reportet ip belongs to",
              "minimum": 1,
              "maximum": 4199999999
            }
          },
          "required": ["SourceIp"]
        }
      ]
    },
    "IpAndUrlBasedReport": {
      "allOf": [
        {
          "$ref": "#/properties/ReportBase"
        },
        {
          "$ref": "#/properties/Date"
        },
        {
          "type": "object",
          "properties": {
            "SourcePort": {
              "$ref": "#/properties/Port"
            }
          }
        },
        {
          "anyOf": [
            {
              "type": "object",
              "required": ["SourceIp"],
              "properties": {
                "SourceIp": {
                  "description": "ip from which the abuse event originated",
                  "$ref": "#/properties/Ip"
                },
                "ASN": {
                  "type": "integer",
                  "description": "autonomous system number the reportet ip belongs to",
                  "minimum": 1,
                  "maximum": 4199999999
                }
              }
            },
            {
              "type": "object",
              "required": ["SourceUrl"],
              "properties": {
                "SourceUrl": {
                  "type": "string",
                  "description": "url of the abuse event origin",
                  "format": "uri"
                }
              }
            }
          ]
        }
      ]
    },
    "Ip": {
      "title": "IP information, either ipv4 or ipv6",
      "oneOf": [
        {
          "type": "string",
          "format": "ipv4"
        },
        {
          "type": "string",
          "format": "ipv6"
        }
      ]
    },
    "Port": {
      "title": "Port information",
      "type": "integer",
      "minimum": 0,
      "maximum": 65535
    },
    "AccountBasedReport": {
      "allOf": [
        {
          "$ref": "#/properties/ReportBase"
        },
        {
          "$ref": "#/properties/Date"
        },
        {
          "type": "object",
          "required": ["Account"],
          "properties": {
            "Account": {
              "type": "object",
              "minProperties": 1,
              "description": "Account data of the reportee",
              "properties": {
                "AccountIdentifier": {
                  "type": "string",
                  "description": "reported account name or other identifier",
                  "not": {
                    "description": "email based user accounts should go to the AccountEmail field",
                    "format": "email"
                  }
                },
                "AccountEmail": {
                  "type": "string",
                  "description": "email account of the user"
                }
              }
            }
          }
        }
      ]
    },
    "Sample": {
      "description": "Evidence sample",
      "type": "object",
      "anyOf": [
        {
          "properties": {
            "ContentType": {
              "type": "string",
              "description": "content type of the sample (e.g. application/rfc822 or image/jpg)"
            },
            "Base64Encoded": {
              "type": "boolean",
              "description": "if payload is base64 encoded. Useful to avoid losing encoding information (e.g. in mails)",
              "default": false
            },
            "Description": {
              "type": "string",
              "description": "description of the sample in plain text"
            },
            "Payload": {
              "type": "string",
              "description": "actual sample"
            }
          },
          "required": ["ContentType", "Payload"]
        },
        {
          "$ref": "#/properties/File"
        }
      ]
    },
    "CommonProps": {
      "type": "object",
      "description": "collection of common, but not easily classified fields",
      "properties": {
        "Ongoing": {
          "type": "boolean",
          "description": "is the reported abuse ongoing?"
        },
        "ThreatActor": {
          "type": "string",
          "description": "!TODO!"
        },
        "Samples": {
          "type": "array",
          "description": "Samples of the abuse taking place, e.g. malware file or spam email",
          "items": {
            "$ref": "#/properties/Sample"
          },
          "minItems": 1
        }
      }
    },
    "Date": {
      "description": "stores either a single date or two dates, one for the first occurrence of the event, one for the most recent",
      "type": "object",
      "required": ["Date"],
      "properties": {
        "Date": {
          "format": "date-time",
          "type": "string",
          "description": "most recent date-time the event was noticed"
        },
        "FirstSeen": {
          "format": "date-time",
          "type": "string",
          "description": "date-time the event was first noticed. Can be omitted if it is the same as Date"
        }
      }
    },
    "File": {
      "description": "Additional properties for xarf report types about a specific file",
      "type": "object",
      "properties": {
        "FileName": {
          "type": "string",
          "description": "name of the file"
        },
        "FileSize": {
          "type": "integer",
          "description": "file size in byte",
          "minimum": 0
        },
        "FileHash": {
          "$ref": "#/properties/Hash"
        }
      },
      "required": ["FileName"]
    },
    "Password": {
      "description": "Password information",
      "type": "object",
      "properties": {
        "PasswordHash": {
          "$ref": "#/properties/Hash"
        }
      }
    },
    "Hash": {
      "description": "The hash value of eg. a file or a password.",
      "type": "object",
      "properties": {
        "HashValue": {
          "type": "string"
        },
        "HashAlgorithm": {
          "type": "string",
          "enum": ["sha1", "sha2", "sha3", "sha256", "sha512", "md5", "argon2id", "scrypt", "bcrypt", "pbkdf2"]
        },
        "HashComplete": {
          "type": "boolean",
          "default": true,
          "description": "Whether the complete hash is attached. The alternative is to only attach the first N characters of the computed hash."
        }
      },
      "required": ["HashValue", "HashAlgorithm"]
    },
    "WithDestination": {
      "type": "object",
      "description": "specify a target or destination",
      "properties": {
        "DestinationIp": {
          "description": "targeted ip",
          "$ref": "#/properties/Ip"
        },
        "DestinationPort": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/properties/Port",
                "description": "targeted port"
              }
            },
            {
              "$ref": "#/properties/Port",
              "description": "targeted port"
            }
          ]
        }
      }
    },
    "WithAttacker": {
      "type": "object",
      "description": "Specify the source of an attack. Used when attack source is not the subject of the report, eg. in an PotentiallyCompromisedAccount report.",
      "properties": {
        "AttackerIp": {
          "description": "attacker ip",
          "$ref": "#/properties/Ip"
        },
        "AttackerPort": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/properties/Port",
                "description": "attack port"
              }
            },
            {
              "$ref": "#/properties/Port",
              "description": "attack port"
            }
          ]
        }
      }
    },
    "WithTrafficStats": {
      "type": "object",
      "properties": {
        "ByteCount": {
          "type": "integer",
          "description": "Bytes per second"
        },
        "PacketCount": {
          "type": "integer",
          "description": "Packets per second"
        }
      }
    },
    "EMail": {
      "type": "object",
      "description": "Simplified e-mail object to attach the source e-mail to a report",
      "properties": {
        "SmtpMailFromAddress": {
          "type": "string",
          "format": "email"
        },
        "SmtpRcptToAddress": {
          "type": "string",
          "format": "email"
        }
      }
    },
    "IP": {
      "oneOf": [
        {
          "type": "object",
          "description": "IPv4 address",
          "properties": {
            "IP": {
              "type": "string",
              "format": "ipv4"
            }
          }
        },
        {
          "type": "object",
          "description": "IPv6 address",
          "properties": {
            "IP": {
              "type": "string",
              "format": "ipv6"
            }
          }
        }
      ]
    },
    "Service": {
      "type": "object",
      "description": "Specify a service to report",
      "required": ["ServiceName"],
      "properties": {
        "ServiceName": {
          "type": "string"
        },
        "ServiceVersion": {
          "type": "string",
          "description": "Affected service version or version range"
        }
      }
    },
    "TransportProtocol": {
      "type": "object",
      "description": "Transport protocol used by the reportee",
      "properties": {
        "TransportProtocol": {
          "type": "string",
          "enum": ["tcp", "udp"]
        }
      }
    },
    "InternalProcessing": {
      "type": "object",
      "description": "Information about the reportee for internal processing. This should be ignored if the reporter isn't authorized. It's intended to be used for relaying internaly generated xarf-reports to automation software.",
      "properties": {
        "SubscriberInformation": {
          "type": "object",
          "description": "Information about the reportee/customer.",
          "properties": {
            "ID": {
              "type": "string",
              "description": "Internal ID of the reportee."
            },
            "SubscriberData": {
              "type": "object",
              "description": "Data about a customer normally returned by a resolver in the process of determining the reportee.",
              "additionalProperties": {
                "type": "string"
              }
            }
          }
        },
        "ContractInformation": {
          "type": "object",
          "description": "Information about the reportee's/customer's contract.",
          "properties": {
            "ID": {
              "type": "string",
              "description": "Internal ID of the reportee's contract."
            },
            "ResolverData": {
              "type": "object",
              "description": "Data about a customers contract normaly returned by a resolver in the process of determining the reportee.",
              "additionalProperties": {
                "type": "string"
              }
            }
          }
        },
        "EventTags": {
          "type": "array",
          "description": "Custom tags for classification, metrics and other internal uses.",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
